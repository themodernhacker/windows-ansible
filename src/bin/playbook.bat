@echo off
echo Running playbook command...

echo use "vault.sig"; > "%TEMP%\play_run.sml"
echo use "vault.sml"; >> "%TEMP%\play_run.sml"
echo use "active_directory.sig"; >> "%TEMP%\play_run.sml"
echo use "active_directory.sml"; >> "%TEMP%\play_run.sml"
echo use "windows_module.sig"; >> "%TEMP%\play_run.sml"
echo use "windows_module.sml"; >> "%TEMP%\play_run.sml"
echo use "inventory.sig"; >> "%TEMP%\play_run.sml"
echo use "inventory.sml"; >> "%TEMP%\play_run.sml"
echo use "task_executor.sig"; >> "%TEMP%\play_run.sml"
echo use "task_executor.sml"; >> "%TEMP%\play_run.sml"
echo use "playbook.sig"; >> "%TEMP%\play_run.sml"
echo use "playbook.sml"; >> "%TEMP%\play_run.sml"
echo use "permission.sig"; >> "%TEMP%\play_run.sml"
echo use "permission.sml"; >> "%TEMP%\play_run.sml"
echo use "template.sig"; >> "%TEMP%\play_run.sml"
echo use "template.sml"; >> "%TEMP%\play_run.sml"
echo use "main.sml"; >> "%TEMP%\play_run.sml"

echo structure PlaybookCommand = struct >> "%TEMP%\play_run.sml"
echo   val _ = print "=== Windows Ansible Core - Playbook ===\n" >> "%TEMP%\play_run.sml"
echo   val _ = print "Simulating playbook execution...\n" >> "%TEMP%\play_run.sml"
echo   val playbook_name = if CommandLine.arguments() = [] then "default.yml" >> "%TEMP%\play_run.sml"
echo                       else hd(CommandLine.arguments()) >> "%TEMP%\play_run.sml"
echo   val _ = print ("Playbook: " ^ playbook_name ^ "\n") >> "%TEMP%\play_run.sml"
echo   val _ = print "\nTasks:\n" >> "%TEMP%\play_run.sml"
echo   val _ = print "  - Setup\n" >> "%TEMP%\play_run.sml"
echo   val _ = print "  - Copy files\n" >> "%TEMP%\play_run.sml" 
echo   val _ = print "  - Configure service\n" >> "%TEMP%\play_run.sml"
echo   val _ = print "\nPlaybook completed successfully\n" >> "%TEMP%\play_run.sml"
echo end >> "%TEMP%\play_run.sml"

sml < "%TEMP%\play_run.sml"
del "%TEMP%\play_run.sml" >nul 2>&1